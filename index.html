<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Card Request | Frama-Tech</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --ink: #1a1a1a;
      --paper: #f8f8f8;
      --cream: #f0f0f0;
      --frama-blue: #1E2D7D;
      --frama-blue-hover: #162260;
      --muted: #666666;
      --border: #e0e0e0;
      --success: #2d5a3d;
      --error: #8b3a3a;
      --pending: #6366f1;
      --warning: #b8860b;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--paper); color: var(--ink); min-height: 100vh; line-height: 1.6; }
    .nav-bar { position: fixed; top: 0; left: 0; right: 0; background: white; border-bottom: 1px solid var(--border); padding: 0.75rem 2rem; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
    .nav-logo { height: 32px; }
    .nav-logo img { height: 100%; width: auto; }
    .nav-title { font-size: 1.25rem; font-weight: 600; color: var(--ink); }
    .nav-tabs { display: flex; gap: 0.5rem; }
    .nav-tab { padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500; color: var(--muted); background: none; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
    .nav-tab:hover { background: var(--cream); color: var(--ink); }
    .nav-tab.active { background: var(--frama-blue); color: white; }
    .app-container { display: grid; grid-template-columns: 1fr 1fr; min-height: 100vh; padding-top: 57px; }
    @media (max-width: 1100px) { .app-container { grid-template-columns: 1fr; } }
    .form-panel { padding: 3rem; display: flex; flex-direction: column; justify-content: center; max-width: 600px; margin: 0 auto; width: 100%; }
    @media (max-width: 1100px) { .form-panel { padding: 2rem 1.5rem; order: 2; } }
    .form-header { margin-bottom: 2.5rem; }
    .form-header h1 { font-size: 2rem; font-weight: 600; letter-spacing: -0.02em; margin-bottom: 0.5rem; line-height: 1.2; }
    .form-header p { color: var(--muted); font-size: 0.95rem; }
    .form-section { margin-bottom: 2rem; }
    .section-title { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 1.25rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border); }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .form-row.three-col { grid-template-columns: 2fr 1fr 1fr; }
    @media (max-width: 500px) { .form-row, .form-row.three-col { grid-template-columns: 1fr; } }
    .form-group { margin-bottom: 1rem; }
    .form-group.full-width { grid-column: 1 / -1; }
    label { display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.4rem; color: var(--ink); }
    label .optional { font-weight: 400; color: var(--muted); font-size: 0.8rem; }
    input, select, textarea { width: 100%; padding: 0.75rem 1rem; font-size: 0.95rem; font-family: inherit; border: 1px solid var(--border); border-radius: 6px; background: white; color: var(--ink); transition: all 0.2s ease; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--frama-blue); box-shadow: 0 0 0 3px rgba(30, 45, 125, 0.12); }
    input::placeholder, textarea::placeholder { color: #aaa; }
    textarea { min-height: 80px; resize: vertical; }
    select { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23666666' viewBox='0 0 16 16'%3E%3Cpath d='M8 10.5l-4-4h8l-4 4z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; padding-right: 2.5rem; }
    .custom-address-fields { margin-top: 1rem; padding: 1rem; background: var(--cream); border-radius: 6px; }
    .custom-address-fields .form-group:last-child { margin-bottom: 0; }
    .submit-btn { width: 100%; padding: 1rem 2rem; font-size: 1rem; font-weight: 600; font-family: inherit; background: var(--frama-blue); color: white; border: none; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; margin-top: 1rem; }
    .submit-btn:hover { background: var(--frama-blue-hover); transform: translateY(-1px); }
    .submit-btn:active { transform: translateY(0); }
    .submit-btn:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
    .preview-panel { background: var(--cream); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem; position: relative; overflow: hidden; }
    @media (max-width: 1100px) { .preview-panel { padding: 2rem 1.5rem; min-height: 320px; order: 1; } }
    .preview-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.15em; color: var(--muted); margin-bottom: 1.5rem; }
    .card-preview { width: 100%; max-width: 400px; aspect-ratio: 1.75; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.08), 0 12px 30px rgba(0,0,0,0.1); display: flex; position: relative; overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card-preview:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.06), 0 8px 20px rgba(0,0,0,0.1), 0 20px 40px rgba(0,0,0,0.12); }
    .card-logo-section { width: 18%; background: white; display: flex; align-items: center; justify-content: center; position: relative; }
    .card-logo-section img { position: absolute; transform: rotate(-90deg); width: 210px; max-width: none; }
    .card-content { flex: 1; padding: 1.25rem 1.5rem; display: flex; flex-direction: column; justify-content: center; margin-left: 8%; }
    .card-name { font-size: 1.1rem; font-weight: 600; color: var(--frama-blue); margin-bottom: 0.1rem; line-height: 1.3; text-transform: capitalize;}
    .card-title { font-size: 0.8rem; color: #333; margin-bottom: 0.75rem; }
    .card-address { font-size: 0.7rem; color: #333; line-height: 1.5; margin-bottom: 0.75rem; }
    .card-address-line { display: block; }
    .card-contact { font-size: 0.7rem; color: #333; line-height: 1.6; }
    .card-contact-line { display: block; }
    .placeholder-text { color: #ccc; font-style: italic; }
    .success-state { text-align: center; padding: 3rem 2rem; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .success-icon { width: 80px; height: 80px; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem; }
    .success-icon svg { width: 40px; height: 40px; color: white; }
    .success-state h2 { font-size: 1.75rem; font-weight: 600; margin-bottom: 1rem; }
    .success-state p { color: var(--muted); margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto; }
    .reset-btn { padding: 0.75rem 2rem; font-size: 0.9rem; font-weight: 500; font-family: inherit; background: transparent; color: var(--ink); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
    .reset-btn:hover { background: var(--cream); border-color: var(--ink); }
    .admin-container { max-width: 1200px; margin: 0 auto; padding: 5rem 2rem 3rem; }
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2.5rem; flex-wrap: wrap; gap: 1rem; }
    .admin-header h1 { font-size: 1.75rem; font-weight: 600; }
    .admin-actions { display: flex; gap: 0.75rem; }
    .export-btn, .clear-btn { padding: 0.6rem 1.25rem; font-size: 0.85rem; font-weight: 500; font-family: inherit; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
    .export-btn { background: var(--frama-blue); color: white; border: none; }
    .export-btn:hover { background: var(--frama-blue-hover); }
    .clear-btn { background: transparent; color: var(--error); border: 1px solid var(--error); }
    .clear-btn:hover { background: #fef2f2; }
    .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 1rem; }
    .stat-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); margin-bottom: 0.25rem; }
    .stat-value { font-size: 2rem; font-weight: 600; }
    .requests-table { background: white; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
    .table-header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); font-size: 0.9rem; font-weight: 600; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
    th { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); background: var(--cream); }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: rgba(30, 45, 125, 0.04); }
    .name-cell { font-weight: 500; }
    .title-cell { color: var(--muted); font-size: 0.875rem; }
    .status-badge { display: inline-flex; align-items: center; padding: 0.25rem 0.6rem; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; border-radius: 50px; cursor: pointer; transition: all 0.2s ease; }
    .status-badge.pending { background: #eef2ff; color: var(--pending); }
    .status-badge.processing { background: #fef3c7; color: var(--warning); }
    .status-badge.completed { background: #dcfce7; color: var(--success); }
    .status-badge:hover { transform: scale(1.05); }
    .date-cell { font-size: 0.8rem; color: var(--muted); }
    .empty-state { text-align: center; padding: 4rem 2rem; color: var(--muted); }
    .empty-state svg { width: 64px; height: 64px; margin-bottom: 1rem; opacity: 0.3; }
    @media (max-width: 768px) { .admin-container { padding: 5rem 1rem 2rem; } th, td { padding: 0.6rem 0.75rem; font-size: 0.8rem; } .hide-mobile { display: none; } }
    .error-msg { color: #dc2626; background: #fef2f2; padding: 0.75rem 1rem; border-radius: 6px; margin-bottom: 1rem; font-size: 0.9rem; }
  </style>
</head>
<body>
  <div id="app">
    <nav class="nav-bar">
      <div class="nav-logo">
        <img src="https://cdn.shopify.com/s/files/1/0520/4187/5630/files/ft-color-logo-with-tagline-png.png?v=1769795875" alt="Frama-Tech">
      </div>
      <h1 class="nav-title">Request Business Cards</h1>
    </nav>

    <div class="app-container">
      <div class="form-panel">
        <div v-if="submitted" class="success-state">
          <div class="success-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
          <h2>Request Submitted</h2>
          <p>Your business card request has been received. Our team will process it within 3-5 business days.</p>
          <button @click="resetForm" class="reset-btn">Submit Another Request</button>
        </div>

        <template v-else>
          <form @submit.prevent="submitForm">
            <div class="form-section">
              <div class="section-title">Enter Business Card Details</div>
              <div class="form-row">
                <div class="form-group">
                  <label for="name">Full Name *</label>
                  <input type="text" id="name" v-model="form.name" placeholder="Jane Smith" required>
                </div>
                <div class="form-group">
                  <label for="title">Title *</label>
                  <input type="text" id="title" v-model="form.title" placeholder="Account Manager" required>
                </div>
              </div>
              <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" v-model="form.email" placeholder="jane@framatech.com" required>
              </div>
              <div class="form-group">
                <label for="location">Office Location *</label>
                <select id="location" v-model="form.location" required>
                  <option value="">Select a location</option>
                  <option value="dallas">Dallas</option>
                  <option value="chicago">Chicago</option>
                  <option value="losangeles">Los Angeles</option>
                  <option value="newyork">New York</option>
                  <option value="navarre">Navarre</option>
                  <option value="custom">Custom Address</option>
                </select>
              </div>
              <div v-if="form.location === 'custom'" class="custom-address-fields">
                <div class="form-group">
                  <label for="address1">Address Line 1 *</label>
                  <input type="text" id="address1" v-model="form.customAddress1" placeholder="123 Main Street" required>
                </div>
                <div class="form-group">
                  <label for="address2">Address Line 2 <span class="optional">(optional)</span></label>
                  <input type="text" id="address2" v-model="form.customAddress2" placeholder="Suite 100">
                </div>
                <div class="form-row three-col">
                  <div class="form-group">
                    <label for="city">City *</label>
                    <input type="text" id="city" v-model="form.customCity" placeholder="City" required>
                  </div>
                  <div class="form-group">
                    <label for="state">State *</label>
                    <input type="text" id="state" v-model="form.customState" placeholder="TX" maxlength="2" required>
                  </div>
                  <div class="form-group">
                    <label for="zip">ZIP *</label>
                    <input type="text" id="zip" v-model="form.customZip" placeholder="75001" required>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="officePhone">Office Phone *</label>
                  <input type="tel" id="officePhone" v-model="form.officePhone" placeholder="800.622.9663" required>
                </div>
                <div class="form-group">
                  <label for="mobilePhone">Mobile Phone <span class="optional">(optional)</span></label>
                  <input type="tel" id="mobilePhone" v-model="form.mobilePhone" placeholder="555.123.4567">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="quantity">Quantity</label>
                  <select id="quantity" v-model="form.quantity">
                    <option value="50">50 cards</option>
                    <option value="100">100 cards</option>
                    <option value="150">100 cards</option>
                    <option value="200">200 cards</option>
                    <option value="400">400 cards</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="notes">Special Requests <span class="optional">(optional)</span></label>
                <textarea id="notes" v-model="form.notes" placeholder="Rush delivery, date needed, etc"></textarea>
              </div>
            </div>

            <div v-if="submitError" class="error-msg">{{ submitError }}</div>
            <button type="submit" class="submit-btn" :disabled="submitting">{{ submitting ? 'Submitting...' : 'Submit Request' }}</button>
          </form>
        </template>
      </div>

      <div class="preview-panel">
        <div class="preview-label">Live Preview</div>
        <div class="card-preview">
          <div class="card-logo-section">
            <img src="https://cdn.shopify.com/s/files/1/0520/4187/5630/files/ft-color-logo-with-tagline-png.png?v=1769795875" alt="Frama-Tech">
          </div>
          <div class="card-content">
            <div class="card-name" :class="{ 'placeholder-text': !form.name }">{{ form.name || 'Your Name' }}</div>
            <div class="card-title" :class="{ 'placeholder-text': !form.title }">{{ form.title || 'Title' }}</div>
            <div class="card-address">
              <span class="card-address-line" :class="{ 'placeholder-text': !displayAddress.line1 }">{{ displayAddress.line1 || 'Address Line 1' }}</span>
              <span class="card-address-line" v-if="displayAddress.line2">{{ displayAddress.line2 }}</span>
              <span class="card-address-line" :class="{ 'placeholder-text': !displayAddress.cityStateZip }">{{ displayAddress.cityStateZip || 'City, ST ZIP' }}</span>
            </div>
            <div class="card-contact">
              <span class="card-contact-line" :class="{ 'placeholder-text': !form.officePhone }">{{ formatOfficePhone }}</span>
              <span class="card-contact-line" v-if="form.mobilePhone">{{ formatMobilePhone }}</span>
              <span class="card-contact-line" :class="{ 'placeholder-text': !form.email }">{{ form.email || 'email@framatech.com' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    const { createApp, ref, reactive, computed, onMounted } = Vue;
    createApp({
      setup() {
        const view = ref('form');
        const requests = ref([]);
        const submitted = ref(false);
        const submitting = ref(false);
        const submitError = ref('');
        
        const locations = {
          dallas: { label: 'Dallas', address1: '2000 E Arbrook Blvd', address2: 'STE 115', city: 'Arlington', state: 'TX', zip: '76014' },
          chicago: { label: 'Chicago', address1: '640 Darling Drive', address2: 'STE 102', city: 'Vernon Hills', state: 'IL', zip: '60061' },
          losangeles: { label: 'Los Angeles', address1: '2001 S Acacia Ave', address2: '', city: 'Compton', state: 'CA', zip: '90220' },
          newyork: { label: 'New York', address1: '194 Candlewood Rd', address2: '', city: 'Bay Shore', state: 'NY', zip: '11706' },
          navarre: { label: 'Navarre', address1: '8851 Navarre Pkwy', address2: '', city: 'Navarre', state: 'FL', zip: '32566' }
        };

        const form = reactive({
          name: '', title: '', email: '', location: '',
          customAddress1: '', customAddress2: '', customCity: '', customState: '', customZip: '',
          officePhone: '', mobilePhone: '', quantity: '50', notes: ''
        });

        const displayAddress = computed(() => {
          if (!form.location) return { line1: '', line2: '', cityStateZip: '' };
          if (form.location === 'custom') {
            const city = form.customCity || '';
            const state = form.customState ? form.customState.toUpperCase() : '';
            const zip = form.customZip || '';
            const cityStateZip = city || state || zip ? `${city}${city && state ? ', ' : ''}${state} ${zip}`.trim() : '';
            return { line1: form.customAddress1, line2: form.customAddress2, cityStateZip };
          }
          const loc = locations[form.location];
          return { line1: loc.address1, line2: loc.address2, cityStateZip: `${loc.city}, ${loc.state} ${loc.zip}` };
        });

        const formatPhone = (phone, type) => {
          if (!phone) return type === 'office' ? '+1 XXX.XXX.XXXX Office' : '';
          const digits = phone.replace(/\D/g, '');
          if (digits.length === 10) return `+1 ${digits.slice(0,3)}.${digits.slice(3,6)}.${digits.slice(6)} ${type === 'office' ? 'Office' : 'Mobile'}`;
          if (digits.length === 11 && digits[0] === '1') return `+1 ${digits.slice(1,4)}.${digits.slice(4,7)}.${digits.slice(7)} ${type === 'office' ? 'Office' : 'Mobile'}`;
          return `+1 ${phone} ${type === 'office' ? 'Office' : 'Mobile'}`;
        };

        const formatOfficePhone = computed(() => formatPhone(form.officePhone, 'office'));
        const formatMobilePhone = computed(() => formatPhone(form.mobilePhone, 'mobile'));
        const getLocationLabel = (locationKey) => locationKey === 'custom' ? 'Custom' : (locations[locationKey]?.label || locationKey);

        const loadRequests = () => { try { const saved = localStorage.getItem('framatechCardRequests'); if (saved) requests.value = JSON.parse(saved); } catch (e) { console.error('Error loading:', e); } };
        const saveRequests = () => { localStorage.setItem('framatechCardRequests', JSON.stringify(requests.value)); };

        const submitForm = async () => {
          submitting.value = true;
          submitError.value = '';
          let addressData = {};
          if (form.location === 'custom') {
            addressData = { address1: form.customAddress1, address2: form.customAddress2, city: form.customCity, state: form.customState, zip: form.customZip };
          } else {
            const loc = locations[form.location];
            addressData = { address1: loc.address1, address2: loc.address2, city: loc.city, state: loc.state, zip: loc.zip };
          }
          const requestData = { name: form.name, title: form.title, email: form.email, location: getLocationLabel(form.location), ...addressData, officePhone: form.officePhone, mobilePhone: form.mobilePhone, quantity: parseInt(form.quantity), notes: form.notes };
          try {
            const response = await fetch('/.netlify/functions/create-trello-card', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestData) });
            const result = await response.json();
            if (!response.ok) throw new Error(result.error || 'Failed to submit');
            const newRequest = { id: Date.now().toString(), ...requestData, location: form.location, status: 'pending', submittedAt: new Date().toISOString(), trelloCardId: result.cardId, trelloCardUrl: result.cardUrl };
            requests.value.push(newRequest);
            saveRequests();
            submitted.value = true;
          } catch (error) {
            console.error('Submit error:', error);
            submitError.value = error.message || 'Failed to submit. Please try again.';
          } finally {
            submitting.value = false;
          }
        };

        const resetForm = () => { Object.keys(form).forEach(key => { form[key] = key === 'quantity' ? '50' : ''; }); submitted.value = false; };
        const cycleStatus = (request) => { const statuses = ['pending', 'processing', 'completed']; request.status = statuses[(statuses.indexOf(request.status) + 1) % 3]; saveRequests(); };
        const formatDate = (dateString) => new Date(dateString).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        const sortedRequests = computed(() => [...requests.value].sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt)));
        const pendingCount = computed(() => requests.value.filter(r => r.status === 'pending').length);
        const processingCount = computed(() => requests.value.filter(r => r.status === 'processing').length);
        const completedCount = computed(() => requests.value.filter(r => r.status === 'completed').length);
        const exportCSV = () => {
          const headers = ['Name', 'Title', 'Email', 'Location', 'Address1', 'Address2', 'City', 'State', 'ZIP', 'Office Phone', 'Mobile Phone', 'Quantity', 'Status', 'Notes', 'Submitted'];
          const rows = requests.value.map(r => [r.name, r.title, r.email, getLocationLabel(r.location), r.address1, r.address2, r.city, r.state, r.zip, r.officePhone, r.mobilePhone, r.quantity, r.status, r.notes, r.submittedAt]);
          const csv = [headers, ...rows].map(row => row.map(cell => `"${cell || ''}"`).join(',')).join('\n');
          const blob = new Blob([csv], { type: 'text/csv' });
          const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `framatech-card-requests-${new Date().toISOString().split('T')[0]}.csv`; a.click();
        };
        const clearAll = () => { if (confirm('Delete all requests?')) { requests.value = []; saveRequests(); } };
        onMounted(loadRequests);

        return { view, form, submitted, submitting, submitError, requests, sortedRequests, pendingCount, processingCount, completedCount, displayAddress, formatOfficePhone, formatMobilePhone, getLocationLabel, submitForm, resetForm, cycleStatus, formatDate, exportCSV, clearAll };
      }
    }).mount('#app');
  </script>
</body>
</html>
